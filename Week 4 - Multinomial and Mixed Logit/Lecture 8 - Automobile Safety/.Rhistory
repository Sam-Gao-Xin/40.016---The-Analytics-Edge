setwd("/Users/james/OneDrive - Singapore University of Technology and Design/SUTD/Year 3/Term 6/40.016 - The Analytics Edge/Week 4/Lecture 8 - Automobile Safety")
rm(list=ls())
safety <- read.csv("safetydata.csv")
safety <- read.csv("safetydata(8).csv")
str(safety)
str(safety)
View(safety)
table(safety$Choice)
safety$Choice<- as.numric(sub("Ch", "", safety$Choice))
safety$Choice<- as.numeric(sub("Ch", "", safety$Choice))
table(safety$Choice)
library(mlogit)
library(mlogit)
library(dfidx)
S<- dfidx(subset(safety, Task<=12), shape="wide", choice="Choice", varying =c(4:83), sep="",idx = list(c("No", "Case")), idnames = c(NA, "alt"))
#S
head(S)
M <- mlogit(Choice~CC+GN+NS+BU+FA+LD+BZ+FC+FP+RP+PP+KA+SC+TS+NV+MA+LB+AF+HU+Price-1, data=S)
M <- mlogit(Choice~CC+GN+NS+BU+FA+LD+BZ+FC+FP+RP+PP+KA+SC+TS+NV+MA+LB+AF+HU+Price-1, data=S)
summary(M)
wtp<- as.numeric(M$coefficients["CC"]/M$coefficients["Price"])
ActualChoice <- subset(safety, Task<=12)[,"Choice"]
P <- predict(M, newdata=S)
P <- predict(M, newdata=S)
PredictedChoice <- apply(P,1,which.max)
Tabtrain=table(PredictedChoice, ActualChoice)
Tabtrain
CorPredTrain<-sum(diag(Tabtrain))/sum(Tabtrain)
CorPredTrain
which(colnames(safety)=="CC1")
which(colnames(safety)=="Price4")
M <- mlogit(Choice~CC+GN+NS+BU+FA+LD+BZ+FC+FP+RP+PP+KA+SC+TS+NV+MA+LB+AF+HU+Price-1, data=S)
M <- mlogit(Choice~CC+GN+NS+BU+FA+LD+BZ+FC+FP+RP+PP+KA+SC+TS+NV+MA+LB+AF+HU+Price-1, data=S)
summary(M)
ActualChoice <- subset(safety, Task<=12)[,"Choice"]
P <- predict(M, newdata=S)
PredictedChoice <- apply(P,1,which.max)
Tabtrain=table(PredictedChoice, ActualChoice)
Tabtrain
CorPredTrain<-sum(diag(Tabtrain))/sum(Tabtrain)
CorPredTrain
Test <-dfidx(subset(safety, Task>12), shape="wide", choice="Choice", varying =c(4:83), sep="",idx = list(c("No", "Case")), idnames = c(NA, "alt"))
TestPredict <- predict(M, newdata=Test)
ActualChoice <- subset(safety, Task>12)[,"Choice"]
PredictedChoice <- apply(TestPredict, 1, which.max)
Tabtest=table(PredictedChoice, ActualChoice)
Tabtrain
Tabtest
CorPredTest<-sum(diag(Tabtest))/sum(Tabtest)
CorPredTest
M1 <- mlogit(Choice~CC+GN+NS+BU+FA+LD+BZ+FC+FP+RP+PP+KA+SC+TS+NV+MA+LB+AF+HU+Price-1, data=S, rpar=c(CC='n', GN='n', NS='n', BU='n',FA='n',LD='n',BZ='n',FC='n',FP='n',RP='n',PP='n',KA='n',SC='n',TS='n',NV='n',MA='n',LB='n',AF='n',HU='n',Price='n'), panel = TRUE, print.level=TRUE)
This fits a mixed logit model where the coefficients are treated as random variables. This is captured with rpar(random parameters) argument where 'n' indicates it is modeled as a normal random variable, panel data captures the fact that we have multiple observations per individual.
summary(M1)
AICM<- -2*M$logLik +2*20
AICM1<- -2*M1$logLik +2*40
as.numeric(AICM)
as.numeric(AICM1)
P1 <- predict(M1, newdata=S)
P1 <- predict(M1, newdata=S)
PredictedChoice1 <- apply(P1, 1, which.max)
ActualChoice <- subset(safety, Task<=12)[,"Choice"]
Tabtrainmixed= table(PredictedChoice1, ActualChoice)
Tabtrain
Tabtrainmixed
CorPredTrmix<-sum(diag(Tabtrainmixed))/sum(Tabtrainmixed)
CorPredTrmix
TestPredict1 <- predict(M1, newdata=Test)
TestPredict1 <- predict(M1, newdata=Test)
PredictedChoice1 <- apply(TestPredict1,1,which.max)
ActualChoice1 <- subset(safety, Task>12)[,"Choice"]
Tabtestmixed= table(PredictedChoice1, ActualChoice1)
Tabtest
Tabtestmixed
CorPredTestmixed<-sum(diag(Tabtestmixed))/sum(Tabtestmixed)
CorPredTestmixed<-sum(diag(Tabtestmixed))/sum(Tabtestmixed)
CorPredTestmixed
ActualChT<-subset(safety, Task>12)
ActChT<-cbind(ActualChT$Ch1,ActualChT$Ch2,ActualChT$Ch3,ActualChT$Ch4)
MNLtestLL<- sum(ActChT*log(TestPredict))
MixedtestLL<-sum(ActChT*log(TestPredict1))
MNLtestLL
MixedtestLL
